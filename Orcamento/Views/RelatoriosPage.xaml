<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Orcamento.ViewModels"
             x:Class="Orcamento.Views.RelatoriosPage"
             Title="Relatórios"
             BackgroundColor="#F5F5F7">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Filtro de Período -->
            <Frame CornerRadius="16" 
                   Padding="20" 
                   HasShadow="True"
                   BackgroundColor="White">
                <VerticalStackLayout Spacing="12">
                    <Label Text="📅 Período" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1C1C1E"/>
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Border Grid.Column="0"
                                StrokeThickness="2"
                                Stroke="#E5E5EA"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="#F9F9FB">
                            <DatePicker Date="{Binding DataInicio}"
                                       Format="dd/MM/yyyy"
                                       TextColor="#1C1C1E"
                                       Margin="12,8"/>
                        </Border>

                        <Border Grid.Column="1"
                                StrokeThickness="2"
                                Stroke="#E5E5EA"
                                StrokeShape="RoundRectangle 12"
                                BackgroundColor="#F9F9FB">
                            <DatePicker Date="{Binding DataFim}"
                                       Format="dd/MM/yyyy"
                                       TextColor="#1C1C1E"
                                       Margin="12,8"/>
                        </Border>
                    </Grid>

                    <Button Text="Filtrar"
                            Command="{Binding FiltrarCommand}"
                            BackgroundColor="#667eea"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="44"
                            FontSize="15"
                            FontAttributes="Bold"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Cards de Resumo -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                <!-- Total Receitas -->
                <Frame Grid.Column="0"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="True"
                       BackgroundColor="White">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="💰"
                               FontSize="28"
                               HorizontalOptions="Center"/>
                        <Label Text="Receitas"
                               FontSize="11"
                               TextColor="#8E8E93"
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding TotalReceitasFormatado}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#34C759"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Total Despesas -->
                <Frame Grid.Column="1"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="True"
                       BackgroundColor="White">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="💸"
                               FontSize="28"
                               HorizontalOptions="Center"/>
                        <Label Text="Despesas"
                               FontSize="11"
                               TextColor="#8E8E93"
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding TotalDespesasFormatado}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#FF3B30"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Saldo -->
                <Frame Grid.Column="2"
                       CornerRadius="16"
                       Padding="16"
                       HasShadow="True"
                       BackgroundColor="White">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="📊"
                               FontSize="28"
                               HorizontalOptions="Center"/>
                        <Label Text="Saldo"
                               FontSize="11"
                               TextColor="#8E8E93"
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding SaldoFormatado}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{Binding CorSaldo}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- Despesas por Categoria -->
            <Frame CornerRadius="16" 
                   Padding="20" 
                   HasShadow="True"
                   BackgroundColor="White">
                <VerticalStackLayout Spacing="16">
                    <Label Text="📊 Despesas por Categoria" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1C1C1E"/>

                    <CollectionView ItemsSource="{Binding DespesasPorCategoria}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" RowSpacing="8">
                                    <Label Grid.Column="0"
                                           Text="{Binding Categoria}"
                                           FontSize="15"
                                           TextColor="#1C1C1E"/>
                                    <Label Grid.Column="1"
                                           Text="{Binding ValorFormatado}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="#667eea"/>
                                    <ProgressBar Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Grid.Row="1"
                                                Progress="{Binding Percentual}"
                                                ProgressColor="#667eea"
                                                HeightRequest="6"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Transações Recentes -->
            <Frame CornerRadius="16" 
                   Padding="20" 
                   HasShadow="True"
                   BackgroundColor="White">
                <VerticalStackLayout Spacing="16">
                    <Label Text="🧾 Transações Recentes" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1C1C1E"/>

                    <CollectionView ItemsSource="{Binding TransacoesRecentes}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="16"
                                       CornerRadius="12"
                                       BackgroundColor="#F9F9FB"
                                       HasShadow="False">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <Label Grid.Column="0"
                                               Text="{Binding TipoIcone}"
                                               FontSize="24"
                                               VerticalOptions="Center"/>
                                        <VerticalStackLayout Grid.Column="1"
                                                            Spacing="4"
                                                            Margin="12,0,0,0">
                                            <Label Text="{Binding Descricao}"
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="#1C1C1E"/>
                                            <Label Text="{Binding DataFormatada}"
                                                   FontSize="12"
                                                   TextColor="#8E8E93"/>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="2"
                                               Text="{Binding ValorFormatado}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{Binding CorValor}"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Botões de Exportação -->
            <Frame CornerRadius="16" 
                   Padding="20" 
                   HasShadow="True"
                   BackgroundColor="White">
                <VerticalStackLayout Spacing="12">
                    <Label Text="📥 Exportar Relatório" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1C1C1E"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="📄 PDF"
                                Command="{Binding ExportarPDFCommand}"
                                BackgroundColor="#F2F2F7"
                                TextColor="#1C1C1E"
                                CornerRadius="12"
                                HeightRequest="44"
                                FontSize="15"
                                FontAttributes="Bold"/>

                        <Button Grid.Column="1"
                                Text="📊 Excel"
                                Command="{Binding ExportarExcelCommand}"
                                BackgroundColor="#F2F2F7"
                                TextColor="#1C1C1E"
                                CornerRadius="12"
                                HeightRequest="44"
                                FontSize="15"
                                FontAttributes="Bold"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Loading -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              IsVisible="{Binding IsLoading}"
                              Color="#667eea"
                              HeightRequest="60"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
