<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Orcamento.ViewModels"
             xmlns:models="clr-namespace:Orcamento.Models"
             xmlns:views="clr-namespace:Orcamento.Views"
             x:Class="Orcamento.Views.DashboardPage"
             x:DataType="viewmodels:DashboardViewModel"
             Title="Resumo"
             BackgroundColor="#F2F2F7">

    <ScrollView>
        <VerticalStackLayout Padding="20"
                Spacing="24">

                 <!-- Header com Saudacao e indicador de sincronização -->
                 <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                  <VerticalStackLayout Spacing="4">
                      <Label Text="Olá!"
                          FontSize="34"
                          FontAttributes="Bold"
                          TextColor="#000000"/>
                      <Label Text="{Binding MesAtual}"
                          FontSize="17"
                          TextColor="#8E8E93"/>
                  </VerticalStackLayout>

                  <views:SyncIndicatorView Grid.Column="1"
                                HorizontalOptions="End"
                                VerticalOptions="Center"
                                Margin="0,0,0,8"/>
                 </Grid>

            <!-- Card Principal - Saldo Total -->
            <Border BackgroundColor="#007AFF"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 20">
                <Border.Shadow>
                    <Shadow Brush="#000000"
                            Offset="0,8"
                            Radius="20"
                            Opacity="0.15"/>
                </Border.Shadow>

                <Grid Padding="24"
                        RowSpacing="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Label Grid.Row="0"
                           Text="Saldo Total"
                           FontSize="15"
                           TextColor="White"
                           Opacity="0.8"/>

                    <Label Grid.Row="1"
                           Text="{Binding SaldoTotalFormatado}"
                           FontSize="40"
                           FontAttributes="Bold"
                           TextColor="White"/>

                    <Grid Grid.Row="2"
                            ColumnDefinitions="Auto,*,Auto"
                            ColumnSpacing="8">
                        <Border Grid.Column="0"
                                BackgroundColor="#FFFFFF"
                                StrokeThickness="0"
                                Padding="12,6"
                                StrokeShape="RoundRectangle 8"
                                Opacity="0.2">
                            <Label Text="Ver Detalhes"
                                   FontSize="13"
                                   TextColor="White"/>
                        </Border>
                    </Grid>
                </Grid>
            </Border>

            <!-- Cards de Receitas e Despesas -->
            <Grid ColumnDefinitions="*,*"
                    ColumnSpacing="16">
                <!-- Receitas -->
                <Border Grid.Column="0"
                        BackgroundColor="White"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 16">
                    <Border.Shadow>
                        <Shadow Brush="#000000"
                                Offset="0,4"
                                Radius="12"
                                Opacity="0.08"/>
                    </Border.Shadow>

                    <VerticalStackLayout Padding="20"
                            Spacing="12">
                        <Label Text="&#x1F4C8;"
                               FontSize="28"/>
                        <Label Text="Receitas"
                               FontSize="15"
                               TextColor="#8E8E93"/>
                        <Label Text="{Binding ReceitasMesFormatado}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#34C759"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Despesas -->
                <Border Grid.Column="1"
                        BackgroundColor="White"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 16">
                    <Border.Shadow>
                        <Shadow Brush="#000000"
                                Offset="0,4"
                                Radius="12"
                                Opacity="0.08"/>
                    </Border.Shadow>

                    <VerticalStackLayout Padding="20"
                            Spacing="12">
                        <Label Text="&#x1F4C9;"
                               FontSize="28"/>
                        <Label Text="Despesas"
                               FontSize="15"
                               TextColor="#8E8E93"/>
                        <Label Text="{Binding DespesasMesFormatado}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#FF3B30"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Saldo do Mes -->
            <Border BackgroundColor="White"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 16">
                <Border.Shadow>
                    <Shadow Brush="#000000"
                            Offset="0,4"
                            Radius="12"
                            Opacity="0.08"/>
                </Border.Shadow>

                <Grid Padding="20"
                        ColumnDefinitions="*,Auto">
                    <VerticalStackLayout Grid.Column="0"
                            Spacing="4">
                        <Label Text="Saldo do Mês"
                               FontSize="17"
                               FontAttributes="Bold"
                               TextColor="#000000"/>
                        <Label Text="Diferença entre receitas e despesas"
                               FontSize="13"
                               TextColor="#8E8E93"/>
                    </VerticalStackLayout>

                    <Label Grid.Column="1"
                           Text="{Binding SaldoMesFormatado}"
                           FontSize="28"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           TextColor="{Binding SaldoMes, Converter={StaticResource SaldoToColorConverter}}"/>
                </Grid>
            </Border>

            <!-- Secao: Minhas Contas -->
            <VerticalStackLayout Spacing="16">
                <Label Text="Minhas Contas"
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="#000000"/>

                <CollectionView ItemsSource="{Binding Contas}"
                                SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Conta">
                            <Border BackgroundColor="White"
                                    StrokeThickness="0"
                                    Margin="0,0,0,12"
                                    StrokeShape="RoundRectangle 12">
                                <Border.Shadow>
                                    <Shadow Brush="#000000"
                                            Offset="0,2"
                                            Radius="8"
                                            Opacity="0.06"/>
                                </Border.Shadow>

                                <Grid Padding="16"
                                        ColumnDefinitions="Auto,*,Auto"
                                        ColumnSpacing="16">
                                    <Border Grid.Column="0"
                                            BackgroundColor="#F2F2F7"
                                            WidthRequest="48"
                                            HeightRequest="48"
                                            StrokeThickness="0"
                                            StrokeShape="RoundRectangle 12">
                                        <Label Text="{Binding TipoIcone}"
                                               FontSize="24"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1"
                                            Spacing="4"
                                            VerticalOptions="Center">
                                        <Label Text="{Binding Nome}"
                                               FontSize="17"
                                               FontAttributes="Bold"
                                               TextColor="#000000"/>
                                        <Label Text="{Binding TipoConta}"
                                               FontSize="13"
                                               TextColor="#8E8E93"/>
                                    </VerticalStackLayout>

                                    <Label Grid.Column="2"
                                           Text="{Binding SaldoFormatado}"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"
                                           TextColor="#007AFF"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- Botao Atualizar com estilo iOS -->
            <Border BackgroundColor="#007AFF"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 14">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding RefreshCommand}"/>
                </Border.GestureRecognizers>

                <Label Text="&#x1F504; Atualizar Dados"
                       FontSize="17"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       Padding="0,16"/>
            </Border>

            <!-- Botões de Ação Rápida -->
            <VerticalStackLayout Spacing="12" Margin="0,16,0,0">
                <Label Text="Ações Rápidas"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#000000"/>

                <Grid ColumnDefinitions="*,*"
                      RowDefinitions="Auto,Auto"
                      ColumnSpacing="12"
                      RowSpacing="12">

                    <!-- Nova Transação -->
                    <Border Grid.Column="0" Grid.Row="0"
                            BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 12">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding AdicionarTransacaoRapidaCommand}"/>
                        </Border.GestureRecognizers>
                        <Border.Shadow>
                            <Shadow Brush="#000000"
                                    Offset="0,2"
                                    Radius="8"
                                    Opacity="0.06"/>
                        </Border.Shadow>
                        <VerticalStackLayout Padding="16" Spacing="8">
                            <Label Text="➕" FontSize="32" HorizontalOptions="Center"/>
                            <Label Text="Nova Transação"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#007AFF"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Ver Contas -->
                    <Border Grid.Column="1" Grid.Row="0"
                            BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 12">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavegarParaContasCommand}"/>
                        </Border.GestureRecognizers>
                        <Border.Shadow>
                            <Shadow Brush="#000000"
                                    Offset="0,2"
                                    Radius="8"
                                    Opacity="0.06"/>
                        </Border.Shadow>
                        <VerticalStackLayout Padding="16" Spacing="8">
                            <Label Text="💳" FontSize="32" HorizontalOptions="Center"/>
                            <Label Text="Ver Contas"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#34C759"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Orçamentos -->
                    <Border Grid.Column="0" Grid.Row="1"
                            BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 12">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavegarParaOrcamentosCommand}"/>
                        </Border.GestureRecognizers>
                        <Border.Shadow>
                            <Shadow Brush="#000000"
                                    Offset="0,2"
                                    Radius="8"
                                    Opacity="0.06"/>
                        </Border.Shadow>
                        <VerticalStackLayout Padding="16" Spacing="8">
                            <Label Text="📊" FontSize="32" HorizontalOptions="Center"/>
                            <Label Text="Orçamentos"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#FF9500"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Metas -->
                    <Border Grid.Column="1" Grid.Row="1"
                            BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 12">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding NavegarParaMetasCommand}"/>
                        </Border.GestureRecognizers>
                        <Border.Shadow>
                            <Shadow Brush="#000000"
                                    Offset="0,2"
                                    Radius="8"
                                    Opacity="0.06"/>
                        </Border.Shadow>
                        <VerticalStackLayout Padding="16" Spacing="8">
                            <Label Text="🎯" FontSize="32" HorizontalOptions="Center"/>
                            <Label Text="Metas"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="#AF52DE"/>
                        </VerticalStackLayout>
                    </Border>

                </Grid>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
