<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avila Geo - Demo Interativo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #0a0a0a;
            --text: #ffffff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #050505 0%, #0a0a0a 100%);
            color: var(--text);
            padding: 2rem;
        }

        .container { max-width: 1800px; margin: 0 auto; }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        #map {
            width: 100%;
            height: 600px;
            background: #1a1a1a;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        input, select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text);
            margin-bottom: 0.75rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
        }

        .stat-label {
            color: #9ca3af;
            font-size: 0.85rem;
        }

        .marker-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
        }

        .marker-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .marker-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        @media (max-width: 1200px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="demos.html" class="back-link">‚Üê Voltar aos Demos</a>

        <div class="header">
            <h1>üåç Avila Geo Demo</h1>
            <p>Geolocaliza√ß√£o, mapas e an√°lise espacial</p>
        </div>

        <div class="grid">
            <div class="panel">
                <h2>üõ†Ô∏è Ferramentas</h2>

                <select id="toolMode">
                    <option value="marker">üìç Adicionar Marcador</option>
                    <option value="route">üõ§Ô∏è Tra√ßar Rota</option>
                    <option value="area">üìê Medir √Årea</option>
                    <option value="distance">üìè Medir Dist√¢ncia</option>
                </select>

                <button class="btn btn-primary" onclick="getMyLocation()">üìç Minha Localiza√ß√£o</button>
                <button class="btn btn-secondary" onclick="addRandomMarkers()">üé≤ Gerar Pontos</button>
                <button class="btn btn-secondary" onclick="calculateRoute()">üõ§Ô∏è Calcular Rota</button>
                <button class="btn btn-secondary" onclick="clearMap()">üóëÔ∏è Limpar Mapa</button>

                <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">üìä Estat√≠sticas</h3>

                <div class="stat-card">
                    <div class="stat-label">Marcadores</div>
                    <div class="stat-value" id="markerCount">0</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Dist√¢ncia Total</div>
                    <div class="stat-value" id="totalDistance">0 km</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Centro</div>
                    <div class="stat-value" style="font-size: 1rem;" id="centerCoords">0¬∞, 0¬∞</div>
                </div>

                <h3 style="color: var(--primary); margin: 1.5rem 0 1rem;">üìç Marcadores</h3>
                <div class="marker-list" id="markerList">
                    <div style="color: #9ca3af; text-align: center; padding: 2rem;">
                        Nenhum marcador ainda
                    </div>
                </div>

                <button class="btn btn-success" onclick="exportGeoJSON()">üíæ Exportar GeoJSON</button>
            </div>

            <div class="panel">
                <h2>üó∫Ô∏è Mapa Interativo</h2>
                <div id="map">
                    <canvas id="mapCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1200;
        canvas.height = 600;

        let markers = [];
        let routes = [];
        let centerLat = 0;
        let centerLon = 0;
        let zoom = 1;

        const cities = [
            {name: 'S√£o Paulo', lat: -23.5505, lon: -46.6333, color: '#3b82f6'},
            {name: 'Rio de Janeiro', lat: -22.9068, lon: -43.1729, color: '#8b5cf6'},
            {name: 'Bras√≠lia', lat: -15.8267, lon: -47.9218, color: '#10b981'},
            {name: 'Salvador', lat: -12.9714, lon: -38.5014, color: '#f59e0b'},
            {name: 'Fortaleza', lat: -3.7172, lon: -38.5433, color: '#ef4444'}
        ];

        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for(let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for(let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Draw routes
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            routes.forEach(route => {
                ctx.beginPath();
                route.forEach((point, i) => {
                    const {x, y} = latLonToXY(point.lat, point.lon);
                    if(i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
            });

            // Draw markers
            markers.forEach(marker => {
                const {x, y} = latLonToXY(marker.lat, marker.lon);

                // Draw pin
                ctx.fillStyle = marker.color;
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw label
                if(marker.label) {
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText(marker.label, x + 12, y + 4);
                }
            });

            updateStats();
        }

        function latLonToXY(lat, lon) {
            // Simple mercator projection
            const x = (lon + 180) * (canvas.width / 360);
            const y = (90 - lat) * (canvas.height / 180);
            return {x, y};
        }

        function XYToLatLon(x, y) {
            const lon = (x / canvas.width) * 360 - 180;
            const lat = 90 - (y / canvas.height) * 180;
            return {lat, lon};
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;

            const {lat, lon} = XYToLatLon(x, y);
            const mode = document.getElementById('toolMode').value;

            if(mode === 'marker') {
                addMarker(lat, lon, `Ponto ${markers.length + 1}`);
            } else if(mode === 'route') {
                if(routes.length === 0 || routes[routes.length - 1].length >= 2) {
                    routes.push([]);
                }
                routes[routes.length - 1].push({lat, lon});
                drawMap();
            }
        });

        function addMarker(lat, lon, label, color = '#3b82f6') {
            markers.push({lat, lon, label, color});
            drawMap();
            updateMarkerList();
        }

        function getMyLocation() {
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        addMarker(
                            position.coords.latitude,
                            position.coords.longitude,
                            'Voc√™ est√° aqui',
                            '#10b981'
                        );
                    },
                    () => {
                        alert('‚ùå N√£o foi poss√≠vel obter sua localiza√ß√£o');
                    }
                );
            } else {
                alert('‚ùå Geolocaliza√ß√£o n√£o suportada');
            }
        }

        function addRandomMarkers() {
            cities.forEach(city => {
                addMarker(city.lat, city.lon, city.name, city.color);
            });
        }

        function calculateRoute() {
            if(markers.length < 2) {
                alert('‚ö†Ô∏è Adicione pelo menos 2 marcadores');
                return;
            }

            routes = [markers.map(m => ({lat: m.lat, lon: m.lon}))];
            drawMap();
        }

        function clearMap() {
            markers = [];
            routes = [];
            drawMap();
            updateMarkerList();
        }

        function updateMarkerList() {
            const list = document.getElementById('markerList');

            if(markers.length === 0) {
                list.innerHTML = '<div style="color: #9ca3af; text-align: center; padding: 2rem;">Nenhum marcador ainda</div>';
                return;
            }

            list.innerHTML = markers.map((m, i) => `
                <div class="marker-item">
                    <div>
                        <span class="color-dot" style="background: ${m.color}"></span>
                        <strong>${m.label}</strong>
                    </div>
                    <div style="font-size: 0.75rem; color: #9ca3af;">
                        ${m.lat.toFixed(2)}¬∞, ${m.lon.toFixed(2)}¬∞
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            document.getElementById('markerCount').textContent = markers.length;

            if(markers.length > 1) {
                let totalDist = 0;
                for(let i = 0; i < markers.length - 1; i++) {
                    totalDist += haversineDistance(
                        markers[i].lat, markers[i].lon,
                        markers[i+1].lat, markers[i+1].lon
                    );
                }
                document.getElementById('totalDistance').textContent = totalDist.toFixed(1) + ' km';
            }

            if(markers.length > 0) {
                const avgLat = markers.reduce((sum, m) => sum + m.lat, 0) / markers.length;
                const avgLon = markers.reduce((sum, m) => sum + m.lon, 0) / markers.length;
                document.getElementById('centerCoords').textContent =
                    `${avgLat.toFixed(2)}¬∞, ${avgLon.toFixed(2)}¬∞`;
            }
        }

        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function exportGeoJSON() {
            const geojson = {
                type: 'FeatureCollection',
                features: markers.map(m => ({
                    type: 'Feature',
                    properties: {
                        name: m.label,
                        color: m.color
                    },
                    geometry: {
                        type: 'Point',
                        coordinates: [m.lon, m.lat]
                    }
                }))
            };

            const blob = new Blob([JSON.stringify(geojson, null, 2)], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'avila-geo-export.geojson';
            link.click();
            alert('üíæ GeoJSON exportado!');
        }

        // Initialize
        drawMap();
    </script>
</body>
</html>
